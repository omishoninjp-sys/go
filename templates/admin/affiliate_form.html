{% extends 'admin/base.html' %}

{% block title %}{% if affiliate %}編輯{% else %}新增{% endif %}代購業者 - GoyouLink 分潤系統{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">{% if affiliate %}編輯代購業者{% else %}新增代購業者{% endif %}</h2>
    <a href="{{ url_for('admin.affiliates_list') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> 返回列表
    </a>
</div>

<div class="card">
    <div class="card-body">
        {% if error %}
        <div class="alert alert-danger" role="alert">
            {{ error }}
        </div>
        {% endif %}
        
        <form method="POST">
            <!-- 基本資訊 -->
            <h5 class="mb-3"><i class="bi bi-person"></i> 基本資訊</h5>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="name" class="form-label">名稱 <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="name" name="name" 
                           value="{{ affiliate.name if affiliate else '' }}" required>
                    <div class="form-text">代購業者或推廣者的名稱</div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="type" class="form-label">類型 <span class="text-danger">*</span></label>
                    <select class="form-select" id="type" name="type" required>
                        <option value="affiliate" {% if not affiliate or affiliate.type == 'affiliate' %}selected{% endif %}>一般推廣者（網紅、部落客等）</option>
                        <option value="reseller" {% if affiliate and affiliate.type == 'reseller' %}selected{% endif %}>系統租戶（GoyouLink 代購業者）</option>
                    </select>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email"
                           value="{{ affiliate.email if affiliate else '' }}">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="domain" class="form-label">GoyouLink 網域</label>
                    <input type="text" class="form-control" id="domain" name="domain"
                           value="{{ affiliate.domain if affiliate else '' }}"
                           placeholder="例如：erp.xxx.com">
                    <div class="form-text">僅限系統租戶填寫</div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="commission_rate" class="form-label">佣金比例 (%)</label>
                    <input type="number" class="form-control" id="commission_rate" name="commission_rate"
                           value="{{ affiliate.commission_rate if affiliate else config.DEFAULT_COMMISSION_RATE }}"
                           min="0" max="100" step="0.1">
                    <div class="form-text">預設為 {{ config.DEFAULT_COMMISSION_RATE }}%</div>
                </div>
                
                {% if not affiliate %}
                <div class="col-md-6 mb-3">
                    <label for="ref_code" class="form-label">推薦碼（選填）</label>
                    <input type="text" class="form-control" id="ref_code" name="ref_code"
                           placeholder="留空將自動產生">
                    <div class="form-text">用於追蹤訂單來源，例如「alice」、「shop01」</div>
                </div>
                {% endif %}
                
                {% if affiliate %}
                <div class="col-md-6 mb-3">
                    <label for="status" class="form-label">狀態</label>
                    <select class="form-select" id="status" name="status">
                        <option value="active" {% if affiliate.status == 'active' %}selected{% endif %}>啟用</option>
                        <option value="inactive" {% if affiliate.status == 'inactive' %}selected{% endif %}>停用</option>
                    </select>
                </div>
                {% endif %}
            </div>
            
            <hr class="my-4">
            
            <!-- 社群媒體 -->
            <h5 class="mb-3"><i class="bi bi-share"></i> 社群媒體</h5>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="social_facebook" class="form-label">
                        <i class="bi bi-facebook text-primary"></i> Facebook
                    </label>
                    <input type="url" class="form-control" id="social_facebook" name="social_facebook"
                           value="{{ affiliate.social_facebook if affiliate else '' }}"
                           placeholder="https://www.facebook.com/yourpage">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="social_instagram" class="form-label">
                        <i class="bi bi-instagram text-danger"></i> Instagram
                    </label>
                    <input type="url" class="form-control" id="social_instagram" name="social_instagram"
                           value="{{ affiliate.social_instagram if affiliate else '' }}"
                           placeholder="https://www.instagram.com/youraccount">
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="social_threads" class="form-label">
                        <i class="bi bi-threads text-dark"></i> Threads
                    </label>
                    <input type="url" class="form-control" id="social_threads" name="social_threads"
                           value="{{ affiliate.social_threads if affiliate else '' }}"
                           placeholder="https://www.threads.net/@youraccount">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="social_youtube" class="form-label">
                        <i class="bi bi-youtube text-danger"></i> YouTube
                    </label>
                    <input type="url" class="form-control" id="social_youtube" name="social_youtube"
                           value="{{ affiliate.social_youtube if affiliate else '' }}"
                           placeholder="https://www.youtube.com/@yourchannel">
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="social_tiktok" class="form-label">
                        <i class="bi bi-tiktok text-dark"></i> TikTok
                    </label>
                    <input type="url" class="form-control" id="social_tiktok" name="social_tiktok"
                           value="{{ affiliate.social_tiktok if affiliate else '' }}"
                           placeholder="https://www.tiktok.com/@youraccount">
                </div>
            </div>
            
            <hr class="my-4">
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-lg"></i> {% if affiliate %}儲存{% else %}新增{% endif %}
                </button>
                <a href="{{ url_for('admin.affiliates_list') }}" class="btn btn-outline-secondary">取消</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
