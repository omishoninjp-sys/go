{% extends 'affiliate/base.html' %}

{% block title %}個人資料 - GoyouLink 分潤系統{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">個人資料</h2>
</div>

{% if success %}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle me-2"></i> 個人資料已更新！
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <!-- 基本資訊 -->
                    <h5 class="mb-3"><i class="bi bi-person"></i> 基本資訊</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">名稱</label>
                            <input type="text" class="form-control" value="{{ affiliate.name }}" disabled>
                            <div class="form-text">如需修改請聯繫管理員</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">推薦碼</label>
                            <input type="text" class="form-control" value="{{ affiliate.ref_code }}" disabled>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   value="{{ affiliate.email or '' }}"
                                   placeholder="your@email.com">
                            <div class="form-text">用於接收佣金發放通知</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">佣金比例</label>
                            <input type="text" class="form-control" value="{{ affiliate.commission_rate }}%" disabled>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg"></i> 儲存變更
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- 帳戶統計 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-bar-chart"></i> 帳戶統計</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm mb-0">
                    <tr>
                        <td class="text-muted">總點擊數</td>
                        <td class="text-end fw-bold">{{ affiliate.total_clicks or 0 }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">總訂單數</td>
                        <td class="text-end fw-bold">{{ affiliate.total_orders or 0 }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">總銷售額</td>
                        <td class="text-end fw-bold">¥{{ "{:,.0f}".format(affiliate.total_sales or 0) }}</td>
                    </tr>
                    <tr>
                        <td class="text-muted">總佣金</td>
                        <td class="text-end fw-bold">¥{{ "{:,.0f}".format(affiliate.total_commission or 0) }}</td>
                    </tr>
                    <tr class="table-warning">
                        <td class="text-muted">待發放佣金</td>
                        <td class="text-end fw-bold text-warning">¥{{ "{:,.0f}".format(affiliate.pending_commission or 0) }}</td>
                    </tr>
                    <tr class="table-success">
                        <td class="text-muted">已發放佣金</td>
                        <td class="text-end fw-bold text-success">¥{{ "{:,.0f}".format(affiliate.paid_commission or 0) }}</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- 帳戶資訊 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> 帳戶資訊</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm mb-0">
                    <tr>
                        <td class="text-muted">類型</td>
                        <td class="text-end">
                            {% if affiliate.type == 'reseller' %}
                                <span class="badge bg-primary">系統租戶</span>
                            {% else %}
                                <span class="badge bg-success">推廣者</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted">狀態</td>
                        <td class="text-end">
                            {% if affiliate.status == 'active' %}
                                <span class="badge bg-success">啟用</span>
                            {% else %}
                                <span class="badge bg-secondary">停用</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text-muted">建立時間</td>
                        <td class="text-end">{{ affiliate.created_at[:10] if affiliate.created_at else '-' }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
